# Pulled this file from SE2
# Name of the workflow
name: Integration tests # commented out the Unit tests for now
# This work flow is triggered when pull requests are opened or updated
on: [ pull_request ]
# A workflow run is made up of one or more jobs.
# jobs:
#   # id of job, a string that is unique to the "jobs" node above.
#   test:
#     # Creates a build matrix for your jobs. You can define different
#     # variations of an environment to run each job in.
#     strategy:
#       # A set of different configurations of the virtual  
#       # environment.
#       matrix:
#         device:
#         - "iPhone 11 Pro Max (14.4)"
#       # When set to true, GitHub cancels all in-progress jobs if any        
#       # matrix job fails.
#       fail-fast: true
#     # The type of machine to run the job on.
#     runs-on: macOS-latest
#     # Contains a sequence of tasks.
#     steps:
#     # This step lists all available simulators
#     - name: "List all simulators"
#       run: "xcrun xctrace list devices"
#     # This step specifically finds and starts the Iphone 11 Pro Max Simulator
#     - name: "Start Simulator"
#       run: |
#           IPHONE11=$(xcrun xctrace list devices  2>&1  | grep -m 1 "iPhone 11 Pro Max" | awk -F'[()]' '{print $4}')
#           xcrun simctl boot $IPHONE11
#     # The branch or tag ref that triggered the workflow will be 
#     # checked out.
#     # https://github.com/actions/checkout
#     - uses: actions/checkout@v2
#     # Sets up a flutter environment.
#     # https://github.com/marketplace/actions/flutter-action
#     - uses: subosito/flutter-action@v2
#       with:
#         architecture: x64
#         channel: 'stable' # or: 'dev' or 'beta'
#     # - name: Run Unit Tests
#       # run: flutter test
#     - name: "Run Flutter Driver tests"
#       run: "flutter drive --target=test_driver/app.dart"

# jobs:
#   build_and_test:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v2
    
#     - name: Setup Flutter
#       uses: subosito/flutter-action@v2
#       with:
#         channel: 'stable'
    
#     - name: Get dependencies
#       run: flutter pub get
    
#     - name: Start emulator
#       run: |
#         echo "no" | avdmanager create avd -n test -k "system-images;android-30;google_apis;x86"
#         $ANDROID_HOME/emulator/emulator -avd test -no-window -no-audio -no-snapshot -wipe-data -no-boot-anim &
#         android-wait-for-emulator
    
#     - name: Run Flutter driver tests
#       run: flutter drive --target=test_driver/app.dart --flavor dev --no-sound-null-safety --device-id emulator-5554

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Java
      uses: actions/setup-java@v2
      with:
        java-version: '12.x'

    - name: Set up Flutter
      uses: subosito/flutter-action@v1.2.0

    - name: Install dependencies
      run: flutter pub get

    - name: Run tests on Android
      run: flutter drive --target=test_driver/app.dart -d emulator-5554